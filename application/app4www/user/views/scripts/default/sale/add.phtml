<!DOCTYPE html>
<html lang="zh-CN">
<head>
<?php echo $this->render(SEED_WWW_TPL . '/layouts/headerLink.phtml'); ?>
	<title>快移</title>
    <link href="/ky/css/layouts/base.css" rel="stylesheet">
    <link href="/ky/css/order/order.css" rel="stylesheet">
    <link href="/ky/css/img-upload.css" rel="stylesheet">
    <link href="/ky/bootstrap-table-1.12.1-dist/bootstrap-table.min.css" rel="stylesheet">
    <link href="/ky/bootstrap-select-1.12.4-dist/css/bootstrap-select.min.css" rel="stylesheet">
</head>
<body>

<?php echo $this->render(SEED_WWW_TPL . '/layouts/header.phtml'); ?>

<div class="container-fluid index-body">
	<div class="container">
		<div class="row">
            <div class="col-md-3 company-navigation">
                <div class="panel panel-default">
                    <div class="panel-heading"><?php echo $this->translate('partners'); ?></div>
                    <div class="list-group">
                        <a href="/user/sale" class="list-group-item"><?php echo $this->translate('orderSALLE'); ?></a>
                        <a href="/user/pur" class="list-group-item"><?php echo $this->translate('orderBUY'); ?></a>
                    </div>
                </div>
            </div>

            <div class="col-md-9 order-main">
                <form class="form-horizontal" action="#" method="post" id="order_add_form" name="order_add_form">
                    <input type="hidden" name="accountName" id="accountName">
                    <input type="hidden" name="crncode" id="crncode">
                    <input type="hidden" name="regdCountryCode" id="regdCountryCode" value="<?php echo $this->regdCountryCode; ?>">

                    <div class="panel panel-default">
                        <!-- Default panel contents -->
                        <div class="panel-heading"><?php echo $this->translate('orderINF01');?></div>
                        <div class="panel-body">
                            <?php if (!empty($this->resultMsg)): ?>
                            <div class="alert alert-warning alert-dismissible fade in" role="alert">
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <p><?php echo $this->resultMsg; ?>!</p>
                            </div>
                            <?php endif; ?>

                            <div class="form-group">
                                <label for="buyerName" class="col-sm-2 control-label"><?php echo $this->translate('buyers'); ?></label>
                                <div class="col-sm-4">
                                    <div class="input-group">
                                        <input type="text" class="form-control" name="buyerName" id="buyerName" placeholder="" value="<?php echo $this->orders['buyerName']; ?>" required >
                                        <input type="hidden" name="buyer" id="buyer">
                                        <input type="hidden" name="buyerRegdCountryCode" id="buyerRegdCountryCode">
                                        <a class="input-group-addon" href="javascript:void(0)" data-toggle="modal" data-target="#myModal">
                                            <i class="fas fa-plus"></i>
                                        </a>
                                    </div>
                                </div>

                                <label for="buyerContactName" class="col-sm-2 control-label"><?php echo $this->translate('buyerATTN'); ?></label>
                                <div class="col-sm-4">
                                    <div class="input-group">
                                        <input type="text" class="form-control" name="buyerContactName" id="buyerContactName" placeholder="" value="<?php echo $this->orders['buyerContactName']; ?>" >
                                        <input type="hidden" name="buyerContactID" id="buyerContactID">
                                        <a class="input-group-addon" href="javascript:void(0)" data-toggle="modal" data-target="#buyerContactModal">
                                            <i class="fas fa-plus"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="buyerCrnCode" class="col-sm-2 control-label"><?php echo $this->translate('payCNY'); ?></label>
                                <div class="col-sm-4">
                                    <select class="selectpicker form-control" name="buyerCrnCode" id="buyerCrnCode" data-live-search="true">
                                        <?php echo $this->ShowDictionaryList($this->dic_Setting['CURRENCY'], $this->userLangCode, $this->dic_Setting['CURRENCY'], $this->orders['buyerCrnCode']); ?>
                                    </select>
                                </div>

                                <label for="vendorContactName" class="col-sm-2 control-label"><?php echo $this->translate('thisATTN'); ?></label>
                                <div class="col-sm-4">
                                    <div class="input-group">
                                        <input type="text" class="form-control" name="vendorContactName" id="vendorContactName" placeholder="" value="<?php echo $this->dfContactName; ?>" required >
                                        <input type="hidden" name="vendorContactID" id="vendorContactID" value="<?php echo $this->dfContactID;?>">
                                        <a class="input-group-addon" href="javascript:void(0)" data-toggle="modal" data-target="#contactModal">
                                            <i class="fas fa-plus"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="paymentTerm" class="col-sm-2 control-label"><?php echo $this->translate('remitMD'); ?></label>
                                <div class="col-sm-4">
                                    <select class="selectpicker form-control" name="paymentTerm" id="paymentTerm" data-live-search="true">
                                        <?php echo $this->ShowDictionaryList($this->dic_Setting['PAYMENT_TERM'], $this->userLangCode, $this->dic_Setting['PAYMENT_TERM'], $this->orders['paymentTerm']); ?>
                                    </select>
                                </div>

                                <label for="paymentPeriod" class="col-sm-2 control-label"><?php echo $this->translate('payDD'); ?></label>
                                <div class="col-sm-3">
                                    <input type="number" class="form-control" name="paymentPeriod" id="paymentPeriod" placeholder="" value="0" min="0" step="1" >
                                </div>
                                <div class="col-sm-1">
                                    <p class="form-control-static">DAYS</p>
                                </div>
                            </div>

                            <div class="form-group isSelfSupport">
                                <label for="isSelfSupport" class="col-sm-2 control-label"><?php echo $this->translate('exportMD'); ?></label>
                                <div class="col-sm-8">
                                    <label class="radio-inline">
                                        <input type="radio" name="isSelfSupport" value="0" checked> <?php echo $this->translate('siteEX');?>
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="isSelfSupport" value="1"> <?php echo $this->translate('sellersEX');?>
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="vendorOrderRequest" class="col-sm-2 control-label"><?php echo $this->translate('payNeed'); ?></label>
                                <div class="col-sm-8">
                                    <textarea class="form-control" name="vendorOrderRequest" id="vendorOrderRequest" rows="3"><?php echo $this->orders['vendorOrderRequest']; ?></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel panel-default">
                        <!-- Default panel contents -->
                        <div class="panel-heading"><?php echo $this->translate('orderINF02');?></div>
                        <div class="panel-body">
                            <div class="form-group">
                                <label for="quotationMode" class="col-sm-2 control-label"><?php echo $this->translate('payJJ'); ?></label>
                                <div class="col-sm-8">
                                    <select class="selectpicker form-control" name="quotationMode" id="quotationMode" data-live-search="true">
                                        <?php echo $this->ShowDictionaryList($this->dic_Setting['ORDER_QUOTATION_MODE'], $this->userLangCode, $this->dic_Setting['ORDER_QUOTATION_MODE'], $this->orders['quotationMode']); ?>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="priceTerm" class="col-sm-2 control-label"><?php echo $this->translate('payPrice'); ?></label>
                                <div class="col-sm-8">
                                    <select class="selectpicker form-control" name="priceTerm" id="priceTerm" data-live-search="true">
                                        <?php echo $this->ShowDictionaryList($this->dic_Setting['PRICE_TERM'], $this->userLangCode, $this->dic_Setting['PRICE_TERM'], $this->orders['priceTerm']); ?>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="packingMode" class="col-sm-2 control-label"><?php echo $this->translate('payCasing'); ?></label>
                                <div class="col-sm-8">
                                    <select class="selectpicker form-control" name="packingMode" id="packingMode" data-live-search="true">
                                        <?php echo $this->ShowDictionaryList($this->dic_Setting['ORDER_PACKING_MODE'], $this->userLangCode, $this->dic_Setting['ORDER_PACKING_MODE'], $this->orders['packingMode']); ?>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="packingDesc" class="col-sm-2 control-label"><?php echo $this->translate('packINF'); ?></label>
                                <div class="col-sm-8">
                                    <textarea class="form-control" name="packingDesc" id="packingDesc" rows="3"><?php echo $this->orders['packingDesc']; ?></textarea>
                                </div>
                            </div>

                            <div class="page-header">
                                <h3><?php echo $this->translate('payGoods'); ?></h3>
                            </div>

                            <div class="orderItemDiv"></div>

                            <div class="form-group selectOrderItem">
                                <div class="col-sm-12">
                                    <button type="button" class="btn btn-default btn-lg btn-block" data-toggle="modal" data-target="#orderItemModal">
                                        <i class="fas fa-plus"></i> <?php echo $this->translate('shopADD'); ?>
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="" class="col-sm-2 control-label"><?php echo $this->translate('attachUpload'); ?></label>
                                <div class="col-sm-10">
                                    <?php echo $this->ShowWebuploader($this->orders['attachmentList'], $this->biz_Setting['ORDER'], $this->attach_Setting['ODOD'], $this->orders['orderID']); ?>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel panel-default">
                        <!-- Default panel contents -->
                        <div class="panel-heading"><?php echo $this->translate('orderINF03');?></div>
                        <div class="panel-body">
                            <div class="form-group">
                                <label for="shippingMethod" class="col-sm-2 control-label"><?php echo $this->translate('moveMD'); ?></label>
                                <div class="col-sm-4">
                                    <select class="selectpicker form-control" name="shippingMethod" id="shippingMethod" data-live-search="true">
                                        <?php echo $this->ShowDictionaryList($this->dic_Setting['SHIPPING_METHOD'], $this->userLangCode, $this->dic_Setting['SHIPPING_METHOD'], $this->orders['shippingMethod']); ?>
                                    </select>
                                </div>

                                <label for="clearancePlace" class="col-sm-2 control-label clearancePlace"><?php echo $this->translate('POCRC'); ?></label>
                                <div class="col-sm-4 clearancePlace">
                                    <select class="selectpicker form-control" name="clearancePlace" id="clearancePlace" data-live-search="true">
                                        <?php echo $this->ShowDictionaryList($this->dic_Setting['EXPORT_POINTS'], $this->userLangCode, $this->dic_Setting['EXPORT_POINTS'], $this->orders['clearancePlace']); ?>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group seaPort">
                                <label for="loadingPort" class="col-sm-2 control-label portSHIP"><?php echo $this->translate('portSHIP'); ?></label>
                                <div class="col-sm-4">
                                    <select class="selectpicker form-control" name="loadingPort" id="loadingPort" data-live-search="true" data-dict-code="SEA_PORT">
                                        <option value=""><?php echo $this->translate('et_select'); ?></option>
                                    </select>
                                </div>

                                <label for="dischargePort" class="col-sm-2 control-label portDSCG"><?php echo $this->translate('portDSCG'); ?></label>
                                <div class="col-sm-4">
                                    <select class="selectpicker form-control" name="dischargePort" id="dischargePort" data-live-search="true" data-dict-code="SEA_PORT">
                                        <option value=""><?php echo $this->translate('et_select'); ?></option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group seaPort">
                                <label for="deliveryPort" class="col-sm-2 control-label portDLVY"><?php echo $this->translate('portDLVY'); ?></label>
                                <div class="col-sm-4">
                                    <select class="selectpicker form-control" name="deliveryPort" id="deliveryPort" data-live-search="true" data-dict-code="SEA_PORT">
                                        <option value=""><?php echo $this->translate('et_select'); ?></option>
                                    </select>
                                </div>

                                <label for="shippingServiceType" class="col-sm-2 control-label"><?php echo $this->translate('mabyDATE'); ?></label>
                                <div class="col-sm-4">
                                    <input type="date" class="form-control" name="deliveryDate" id="deliveryDate" placeholder="" value="<?php echo date('Y-m-d');?>" >
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="shippingServiceType" class="col-sm-2 control-label"><?php echo $this->translate('isFCL'); ?></label>
                                <div class="col-sm-6">
                                    <select class="selectpicker form-control" name="shippingServiceType" id="shippingServiceType" data-live-search="true">
                                        <?php echo $this->ShowDictionaryList($this->dic_Setting['SHIPPING_SERVICE_TYPE'], $this->userLangCode, $this->dic_Setting['SHIPPING_SERVICE_TYPE'], $this->orders['shippingServiceType']); ?>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="sizeQuantityMap_20GP" class="col-sm-2 control-label"><?php echo $this->translate('infoFCL'); ?></label>
                                <div class="col-sm-1">
                                    <p class="form-control-static">20GP</p>
                                </div>
                                <div class="col-sm-1">
                                    <input type="number" class="form-control" name="sizeQuantityMap_20GP" id="sizeQuantityMap_20GP" placeholder="" value="<?php echo $this->orders['sizeQuantityMap_20GP']; ?>" min="0" step="1" >
                                </div>
                                <div class="col-sm-1">
                                    <p class="form-control-static">40GP</p>
                                </div>
                                <div class="col-sm-1">
                                    <input type="number" class="form-control" name="sizeQuantityMap_40GP" id="sizeQuantityMap_40GP" placeholder="" value="<?php echo $this->orders['sizeQuantityMap_40GP']; ?>" min="0" step="1" >
                                </div>
                                <div class="col-sm-1">
                                    <p class="form-control-static">40HQ</p>
                                </div>
                                <div class="col-sm-1">
                                    <input type="number" class="form-control" name="sizeQuantityMap_40HP" id="sizeQuantityMap_40HP" placeholder="" value="<?php echo $this->orders['sizeQuantityMap_40HP']; ?>" min="0" step="1" >
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="sizeQuantityMap_45HP" class="col-sm-2 control-label"></label>
                                <div class="col-sm-1">
                                    <p class="form-control-static">45HQ</p>
                                </div>
                                <div class="col-sm-1">
                                    <input type="number" class="form-control" name="sizeQuantityMap_45HP" id="sizeQuantityMap_45HP" placeholder="" value="<?php echo $this->orders['sizeQuantityMap_45HP']; ?>" min="0" step="1" >
                                </div>
                                <div class="col-sm-1">
                                    <p class="form-control-static">20OT</p>
                                </div>
                                <div class="col-sm-1">
                                    <input type="number" class="form-control" name="sizeQuantityMap_20OT" id="sizeQuantityMap_20OT" placeholder="" value="<?php echo $this->orders['sizeQuantityMap_20OT']; ?>" min="0" step="1" >
                                </div>
                                <div class="col-sm-1">
                                    <p class="form-control-static">40OT</p>
                                </div>
                                <div class="col-sm-1">
                                    <input type="number" class="form-control" name="sizeQuantityMap_40OT" id="sizeQuantityMap_40OT" placeholder="" value="<?php echo $this->orders['sizeQuantityMap_40OT']; ?>" min="0" step="1" >
                                </div>
                            </div>

                            <div class="form-group needShipping">
                                <label for="needShipping" class="col-sm-2 control-label"><?php echo $this->translate('logisticSS'); ?></label>
                                <div class="col-sm-8">
                                    <label class="radio-inline">
                                        <input type="radio" name="needShipping" value="1" checked> <?php echo $this->translate('yes');?>
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="needShipping" value="0"> <?php echo $this->translate('no');?>
                                    </label>
                                </div>
                            </div>

                            <div class="form-group shippingRequest">
                                <label for="shippingRequest" class="col-sm-2 control-label"><?php echo $this->translate('logisticND'); ?></label>
                                <div class="col-sm-8">
                                    <textarea class="form-control" name="shippingRequest" id="shippingRequest" rows="3"><?php echo $this->orders['shippingRequest']; ?></textarea>
                                </div>
                            </div>

                            <div class="form-group agency">
                                <label for="isAssignCustomsAgency" class="col-sm-2 control-label"><?php echo $this->translate('selectCHB'); ?></label>
                                <div class="col-sm-8">
                                    <label class="radio-inline">
                                        <input type="radio" name="isAssignCustomsAgency" value="1"> <?php echo $this->translate('yes');?>
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="isAssignCustomsAgency" value="0" checked> <?php echo $this->translate('no');?>
                                    </label>
                                </div>
                            </div>

                            <div class="form-group agency agencyInfo" style="display: none;">
                                <label for="customsAgencyName" class="col-sm-2 control-label"><?php echo $this->translate('nameCHB'); ?></label>
                                <div class="col-sm-4">
                                    <input type="text" class="form-control" name="customsAgencyName" id="customsAgencyName" value="" placeholder="<?php echo $this->translate('whoCHB'); ?>">
                                </div>
                                <div class="col-sm-4">
                                    <input type="text" class="form-control" name="customsAgencyCode" id="customsAgencyCode" value="" placeholder="<?php echo $this->translate('codeCHB'); ?>">
                                </div>
                            </div>

                            <div class="form-group agency">
                                <label for="customClearanceRequest" class="col-sm-2 control-label"><?php echo $this->translate('needCHB'); ?></label>
                                <div class="col-sm-8">
                                    <textarea class="form-control" name="customClearanceRequest" id="customClearanceRequest" rows="3"><?php echo $this->orders['customClearanceRequest']; ?></textarea>
                                </div>
                            </div>

                            <div class="form-group financing">
                                <label for="needFinancing" class="col-sm-2 control-label"><?php echo $this->translate('nameSRV'); ?></label>
                                <div class="col-sm-8">
                                    <label class="radio-inline">
                                        <input type="radio" name="needFinancing" value="1"> <?php echo $this->translate('yes');?>
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="needFinancing" value="0" checked> <?php echo $this->translate('no');?>
                                    </label>
                                </div>
                            </div>

                            <div class="form-group financingRequest" style="display: none;">
                                <label for="financingRequest" class="col-sm-2 control-label"><?php echo $this->translate('needOTH'); ?></label>
                                <div class="col-sm-8">
                                    <textarea class="form-control" name="financingRequest" id="financingRequest" rows="3"><?php echo $this->orders['financingRequest']; ?></textarea>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-sm-offset-2 col-sm-8">
                                    <button type="submit" class="btn btn-warning btn-block"><?php echo $this->translate('save'); ?></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
		</div>
	</div>
</div>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title"><?php echo $this->translate('buyers'); ?></h4>
            </div>

            <div class="modal-body">
                <table id="buyerListTable"></table>
            </div>

            <div class="modal-footer">
<!--                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>-->
                <button type="button" class="btn btn-primary" id="selectBuyerBtn"><?php echo $this->translate('submit'); ?></button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="buyerContactModal" tabindex="-1" role="dialog" aria-labelledby="buyerContactModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title"><?php echo $this->translate('buyerATTN'); ?></h4>
            </div>

            <div class="modal-body">
                <table id="buyerContactListTable"></table>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="selectBuyerContactBtn"><?php echo $this->translate('submit'); ?></button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="contactModal" tabindex="-1" role="dialog" aria-labelledby="contactModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title"><?php echo $this->translate('thisATTN'); ?></h4>
            </div>

            <div class="modal-body">
                <table id="contactListTable"></table>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="selectContactBtn"><?php echo $this->translate('submit'); ?></button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="orderItemModal" tabindex="-1" role="dialog" aria-labelledby="orderItemModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title"><?php echo $this->translate('goodsME'); ?></h4>
            </div>

            <div class="modal-body">
                <table id="orderItemListTable"></table>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="selectOrderItemBtn"><?php echo $this->translate('confirm'); ?></button>
            </div>
        </div>
    </div>
</div>

<?php echo $this->render(SEED_WWW_TPL . '/layouts/footer.phtml'); ?>

<?php echo $this->render(SEED_WWW_TPL . '/layouts/footerLink.phtml'); ?>

<script type="text/javascript" src="/ky/upload/img.js"></script>
<script src="/ky/bootstrap-table-1.12.1-dist/bootstrap-table.min.js"></script>
<script src="/ky/bootstrap-table-1.12.1-dist/locale/bootstrap-table-zh-CN.min.js"></script>
<script type="text/javascript" src="/ky/bootstrap-select-1.12.4-dist/js/bootstrap-select.min.js"></script>

<script type="text/javascript">
    var dataDict = {};

    $().ready(function() {

	});

	$(function () {
        $('.company-navigation').find('a').each(function () {
            if (this.href === document.location.href || document.location.href.search(this.href) >= 0) {
                $(this).addClass('nav-selected');
            } else {
                $(this).removeClass('nav-selected');
            }
        });

        var $buyerTable = $("#buyerListTable"),
            $selectBuyerBtn = $("#selectBuyerBtn"),
            $buyerModal = $("#myModal"),
            $buyer = $("#buyer"),
            $buyerCrnCode = $('#buyerCrnCode'),
            $paymentTerm = $("#paymentTerm"),
            $priceTerm = $("#priceTerm"),
            $buyerContactModal = $("#buyerContactModal"),
            $selectBuyerContactBtn = $("#selectBuyerContactBtn"),
            $buyerContactListTable = $('#buyerContactListTable'),
            $quotationMode = $("#quotationMode"),
            $contactModal = $("#contactModal"),
            $shippingMethod = $("#shippingMethod"),
            $selectContactBtn = $("#selectContactBtn"),
            $contactListTable = $('#contactListTable'),
            $orderItemModal = $("#orderItemModal"),
            $selectOrderItemBtn = $("#selectOrderItemBtn"),
            $orderItemListTable = $('#orderItemListTable'),
            $orderItemDiv = $(".orderItemDiv");

        var dataDictQuery = '/user/common/dict-ajax';
        var dictCode = ["ISIC_INDUSTRY_TYPE", "COUNTRY_ISO_CODE", "PARTNER_STATUS", "PRODUCT_PRICING_UNIT"];
        $.ajax({
            type: "POST",
            url: dataDictQuery,
            data: {
                dictCode: dictCode,
                langCode: '<?php echo $this->userLangCode; ?>'
            },
            dataType: "json",
            success: function (data) {
                $.data(dataDict, 'dataDict', data);

                $('#buyerListTable').bootstrapTable({
                    url: '/user/buyer/buyer-list-ajax',
                    method: 'post',
                    // showRefresh: true,
                    // search: true,
                    pagination: true,
                    classes: 'table table-no-bordered',
                    sidePagination: 'server',
                    contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                    pageNumber: 1,
                    pageSize: 10,
                    clickToSelect: true,
                    queryParams: function(params) {
                        return {
                            limit: params.limit,
                            skip: params.offset,
                            keyword: params.search,
                            partnerStatus: $("#partnerStatus").val()
                        };
                    },
                    columns: [{
                        radio: true
                    },{
                        field: 'toName',
                        title: '<?php echo $this->translate("companyName"); ?>',
                        formatter: function (value, row) {
                            if (value === undefined || value === '' || value === null) {
                                value = "-";
                            }

                            <?php if ($this->userrgCode == 'CN'): ?>

                            <?php else: ?>
                            if (row.toEnName !== null && row.toEnName !== '') {
                                value = row.toEnName;
                            }
                            <?php endif; ?>
                            return value;
                        }
                    }, {
                        field: 'industryCode',
                        title: '<?php echo $this->translate("industry"); ?>',
                        formatter: function (value, row) {
                            if (value === undefined || value === '' || value === null) {
                                value = "-";
                            }

                            var result = value;
                            var data = $.data(dataDict, 'dataDict');
                            $.each(data, function (key, item) {
                                if (key === 'ISIC_INDUSTRY_TYPE') {
                                    $.each(item, function (i, dict) {
                                        if (dict.code === value) {
                                            result = dict.name;
                                        }
                                    });
                                }
                            });
                            return result;
                        }
                    }, {
                        field: 'regdCountryCode',
                        title: '<?php echo $this->translate("regdCountry"); ?>',
                        formatter: function (value, row) {
                            if (value === undefined || value === '' || value === null) {
                                value = "-";
                            }

                            var result = value;
                            var data = $.data(dataDict, 'dataDict');
                            $.each(data, function (key, item) {
                                if (key === 'COUNTRY_ISO_CODE') {
                                    $.each(item, function (i, dict) {
                                        if (dict.code === value) {
                                            result = dict.name;
                                        }
                                    });
                                }
                            });
                            return result;
                        }
                    }, {
                        field: 'partnerStatus',
                        title: '<?php echo $this->translate("state"); ?>',
                        formatter: function (value, row) {
                            if (value === undefined || value === '' || value === null) {
                                value = "-";
                            }

                            var result = value;
                            var data = $.data(dataDict, 'dataDict');
                            $.each(data, function (key, item) {
                                if (key === 'PARTNER_STATUS') {
                                    $.each(item, function (i, dict) {
                                        if (dict.code === value) {
                                            result = dict.name;
                                        }
                                    });
                                }
                            });
                            return result;
                        }
                    }]
                });

                $('#contactListTable').bootstrapTable({
                    url: '/user/account/contactlistajax',
                    method: 'post',
                    // showRefresh: true,
                    // search: true,
                    pagination: true,
                    classes: 'table table-no-bordered',
                    sidePagination: 'server',
                    contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                    pageNumber: 1,
                    pageSize: 10,
                    clickToSelect: true,
                    queryParams: function(params) {
                        return {
                            limit: params.limit,
                            skip: params.offset,
                            keyword: params.search
                        };
                    },
                    columns: [{
                        radio: true
                    },{
                        field: 'name',
                        title: '<?php echo $this->translate("name"); ?>'
                    }, {
                        field: 'ecommloginname',
                        title: '<?php echo $this->translate("username"); ?>'
                    }, {
                        field: 'ecommstatus',
                        title: '<?php echo $this->translate("userP"); ?>',
                        formatter: function (value) {
                            var result = "-";
                            var data = $.data(dataDict, 'dataDict');
                            $.each(data, function (key, item) {
                                if (key === 'ECOMM_STATUS') {
                                    $.each(item, function (i, dict) {
                                        if (dict.code === value) {
                                            result = dict.name;
                                        }
                                    });
                                }
                            });
                            return result;
                        }
                    }, {
                        field: 'contactStatus',
                        title: '<?php echo $this->translate("userPT"); ?>',
                        formatter: function (value) {
                            return (value === '01') ? '<?php echo $this->translate('normal') ?>' : '<?php echo $this->translate('disable'); ?>';
                        }
                    }, {
                        field: 'isDefaultPublic',
                        title: '<?php echo $this->translate("accountDF"); ?>',
                        formatter: function (value, row) {
                            return (value === true) ? '<?php echo $this->translate('yes') ?>' : '<?php echo $this->translate('no'); ?>';
                        }
                    }]
                });
            }
        });

        $buyerContactListTable.bootstrapTable({
            url: '/user/buyer/contact-list-ajax',
            method: 'post',
            // showRefresh: true,
            // search: true,
            pagination: true,
            classes: 'table table-no-bordered',
            sidePagination: 'server',
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            pageNumber: 1,
            pageSize: 10,
            clickToSelect: true,
            queryParams: function(params) {
                return {
                    limit: params.limit,
                    skip: params.offset,
                    keyword: params.search,
                    toID: $("#buyer").val()
                };
            },
            columns: [{
                radio: true
            },{
                field: 'name',
                title: '<?php echo $this->translate("name"); ?>',
                formatter: function (value, row) {
                    if (value === undefined || value === '' || value === null) {
                        value = "-";
                    }
                    return value;
                }
            }, {
                field: 'phone',
                title: '<?php echo $this->translate("personPhone"); ?>',
                formatter: function (value, row) {
                    if (value === undefined || value === '' || value === null) {
                        value = row.mobilePhone;
                    }
                    return value;
                }
            }, {
                field: 'email',
                title: '<?php echo $this->translate("email"); ?>',
                formatter: function (value, row) {
                    if (value === undefined || value === '' || value === null) {
                        value = "-";
                    }
                    return value;
                }
            }, {
                field: 'title',
                title: '<?php echo $this->translate("position"); ?>',
                formatter: function (value, row, index) {
                    return value;
                }
            }]
        });

        $orderItemListTable.bootstrapTable({
            url: '/user/goods/goods-list-ajax',
            method: 'post',
            // showRefresh: true,
            // search: true,
            pagination: true,
            classes: 'table table-no-bordered',
            sidePagination: 'server',
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            pageNumber: 1,
            pageSize: 10,
            clickToSelect: true,
            queryParams: function(params) {
                return {
                    limit: params.limit,
                    skip: params.offset,
                    keyword: params.search,
                    productStatus: $("#productStatus").val()
                };
            },
            columns: [{
                checkbox: true
            },{
                field: 'productName',
                title: '<?php echo $this->translate("productNAME"); ?>'
            }, {
                field: 'productBrand',
                title: '<?php echo $this->translate("brand"); ?>',
                formatter: function (value, row) {
                    if (value === undefined || value === '' || value === null) {
                        value = "-";
                    }
                    return value;
                }
            }, {
                field: 'productModel',
                title: '<?php echo $this->translate("model"); ?>',
                formatter: function (value, row) {
                    if (value === undefined || value === '' || value === null) {
                        value = "-";
                    }
                    return value;
                }
            }, {
                field: 'hscode',
                title: '<?php echo $this->translate("HSCODE"); ?>',
                formatter: function (value, row) {
                    if (value === undefined || value === '' || value === null) {
                        value = "-";
                    }
                    return value;
                }
            }, {
                field: 'rebateRate',
                title: '<?php echo $this->translate("rebateRate"); ?>',
                formatter: function (value, row) {
                    if (value === undefined || value === '' || value === null) {
                        value = "-";
                    }
                    return value;
                }
            }]
        });

        $selectBuyerBtn.click(function () {
            // alert('getSelections: ' + JSON.stringify($buyerTable.bootstrapTable('getSelections')));
            // console.log(JSON.stringify($buyerTable.bootstrapTable('getSelections')));
            var selections = $buyerTable.bootstrapTable('getSelections'),
                $regdCountryCode = $("#regdCountryCode"),
                $buyerRegdCountryCode = $("#buyerRegdCountryCode");

            if (selections.length > 0) {
                $buyer.val(selections[0].toID);
                $("#buyerName").val(selections[0].toName);
                $buyerCrnCode.selectpicker('val', selections[0].crnCode);
                $buyerRegdCountryCode.val(selections[0].regdCountryCode);

                $("#buyerContactID").val("");
                $("#buyerContactName").val("");
                $.each(selections[0].contactList, function(i, contact) {
                    if (contact.isDefaultPublic === true) {
                        $("#buyerContactID").val(contact.contactID);
                        $("#buyerContactName").val(contact.name);
                        return false;
                    }
                });

                var options = {
                    query:{
                        toID: $buyer.val()
                    }
                };
                $buyerContactListTable.bootstrapTable('refresh', options);
                $buyerModal.modal('hide');

                // 国籍相同隐藏出口方式, 报关口岸, 报关行
                if ($regdCountryCode.val() === $buyerRegdCountryCode.val()) {
                    $(".isSelfSupport").hide();
                    $(".clearancePlace").hide();
                    $(".agency").hide();
                } else {
                    $(".isSelfSupport").show();
                    $(".clearancePlace").show();
                    $(".agency").show();
                    if ($("input[name='isAssignCustomsAgency']:checked").val() === '0') {
                        $(".agencyInfo").hide();
                    }
                }

                // 更新商品货币
                updateCrnCode($buyerCrnCode.val());
            }
        });

        // 订单货币
        $buyerCrnCode.on('changed.bs.select', function(e, clickedIndex, newValue, oldValue) {
            // console.log(this.value, clickedIndex, newValue, oldValue)
            updateCrnCode(this.value);
        });

        // 结算方式
        $paymentTerm.on('changed.bs.select', function(e, clickedIndex, newValue, oldValue) {
            // console.log(this.value, clickedIndex, newValue, oldValue)
            if (this.value === 'T/T') {
                $(".financing, .financingRequest").hide();
            } else {
                $(".financing").show();
                if ($("input[name='needFinancing']:checked").val() === '1') {
                    $(".financingRequest").show();
                }
            }
        });

        // 计价方式
        $quotationMode.on('changed.bs.select', function(e, clickedIndex, newValue, oldValue) {
            // console.log(this.value, clickedIndex, newValue, oldValue)
            var $products = $("div[data-type='product']"),
                quotationMode = this.value;
            $.each($products, function (i, product) {
                var productID = $(product).attr("id"),
                    productionMode = $("#productionMode_" + productID).val(),
                    $purchaseUnitPrice = $(product).find(".purchaseUnitPrice"),
                    $purtotal = $(product).find(".purtotal"),
                    $unitPrice = $("#unitPrice_" + productID),
                    $totalPrice = $("#totalPrice_" + productID),
                    $purchaseUnitPriceInfo = $(product).find(".purchaseUnitPriceInfo");

                if (quotationMode === 'PO') {   // PO/PI, 隐藏
                    if (productionMode === '02') {
                        $purchaseUnitPrice.html('<?php echo $this->translate("purchaseUnitPrice"); ?>');
                        $purtotal.html('<?php echo $this->translate("purtotal"); ?>');
                    } else {
                        $purchaseUnitPriceInfo.hide();
                    }
                    $unitPrice.removeAttr("readonly");
                } else if (quotationMode === 'IV') {    // 开票, 显示
                    $purchaseUnitPrice.html('<?php echo $this->translate("uiprice"); ?>');
                    $purtotal.html('<?php echo $this->translate("uitotal"); ?>');
                    $purchaseUnitPriceInfo.show();
                    $unitPrice.attr("readonly", "true");
                    $totalPrice.attr("readonly", "true");
                }
            });
        });

        // 价格条款
        $priceTerm.on('changed.bs.select', function(e, clickedIndex, newValue, oldValue) {
            // console.log(this.value, clickedIndex, newValue, oldValue)
            if (this.value === 'EXW') {
                $(".needShipping, .shippingRequest").hide();
            } else {
                $(".needShipping").show();
                if ($("input[name='needShipping']:checked").val() === '1') {
                    $(".shippingRequest").show();
                }
            }
        });

        var loadingPortSelect = $("#loadingPort"),
            dischargePortSelect = $("#dischargePort"),
            deliveryPortSelect = $("#deliveryPort");
        // 运输方式
        $shippingMethod.on('changed.bs.select', function(e, clickedIndex, newValue, oldValue) {
            // console.log(this.value, clickedIndex, newValue, oldValue)
            if (this.value === 'SEA') {
                $(loadingPortSelect).attr("data-dict-code", "SEA_PORT");
                $(dischargePortSelect).attr("data-dict-code", "SEA_PORT");
                $(deliveryPortSelect).attr("data-dict-code", "SEA_PORT");

                $(".portSHIP").html("<?php echo $this->translate('portSHIP'); ?>");
                $(".portDSCG").html("<?php echo $this->translate('portDSCG'); ?>");
                $(".portDLVY").html("<?php echo $this->translate('portDLVY'); ?>");
            } else if (this.value === 'AIR') {
                $(loadingPortSelect).attr("data-dict-code", "AIR_PORT");
                $(dischargePortSelect).attr("data-dict-code", "AIR_PORT");
                $(deliveryPortSelect).attr("data-dict-code", "AIR_PORT");

                $(".portSHIP").html("<?php echo $this->translate('portSHIP'); ?>");
                $(".portDSCG").html("<?php echo $this->translate('portDSCG'); ?>");
                $(".portDLVY").html("<?php echo $this->translate('portDLVY'); ?>");
            } else if (this.value === 'EXPRESS' || this.value === 'LAND') {
                $(loadingPortSelect).attr("data-dict-code", "CITY_ISO_CODE");
                $(dischargePortSelect).attr("data-dict-code", "CITY_ISO_CODE");
                $(deliveryPortSelect).attr("data-dict-code", "CITY_ISO_CODE");

                $(".portSHIP").html("<?php echo $this->translate('citypost1'); ?>");
                $(".portDSCG").html("<?php echo $this->translate('citypost2'); ?>");
                $(".portDLVY").html("<?php echo $this->translate('citypost3'); ?>");
            }

            var optionString = "<option value=''><?php echo $this->translate('et_select'); ?></option>";
            $(loadingPortSelect).html("");
            $(loadingPortSelect).append(optionString);
            $(loadingPortSelect).selectpicker('refresh');

            $(dischargePortSelect).html("");
            $(dischargePortSelect).append(optionString);
            $(dischargePortSelect).selectpicker('refresh');

            $(deliveryPortSelect).html("");
            $(deliveryPortSelect).append(optionString);
            $(deliveryPortSelect).selectpicker('refresh');
        });

        // 起运港
        var timeOut = "";
        $(loadingPortSelect).on('shown.bs.select', function (e) {
            $(loadingPortSelect).prev().find("input").keyup(function (event) {
                var e = event || window.event || arguments.callee.caller.arguments[0];
                if (e && e.keyCode !== 38 && e.keyCode !== 40) { // 按 Up Down
                    $(loadingPortSelect).prev().find("input").attr('id', "loadingPortInput"); //为input增加id属性
                    var loadingPortInput = $("#loadingPortInput");
                    var keyword = $(loadingPortInput).val();
                    var hscodeQuery = '/user/common/dict-fuzzy-query-ajax';
                    clearTimeout(timeOut);
                    timeOut = setTimeout(function () {
                        $.ajax({
                            type: "POST",
                            url: hscodeQuery,
                            data: {
                                dictCode: $(loadingPortSelect).attr("data-dict-code"),
                                langCode: '<?php echo $this->userLangCode; ?>',
                                keyword: keyword
                            },
                            dataType: "json",
                            success: function (data) {
                                var optionString = "";
                                if (data.length <= 0) {
                                    optionString += "<option value=''><?php echo $this->translate('et_select'); ?></option>";
                                }
                                $.each(data, function (i, item) {
                                    // console.log(item);
                                    optionString += "<option value='" + item.id + "'>" + item.name + "</option>";
                                });

                                $(loadingPortSelect).html("");
                                $(loadingPortSelect).append(optionString);
                                $(loadingPortSelect).selectpicker('refresh');
                            }
                        });
                    }, 100);
                }
            })
        });

        // 卸货港
        $(dischargePortSelect).on('shown.bs.select', function (e) {
            $(dischargePortSelect).prev().find("input").keyup(function (event) {
                var e = event || window.event || arguments.callee.caller.arguments[0];
                if (e && e.keyCode !== 38 && e.keyCode !== 40) { // 按 Up Down
                    $(dischargePortSelect).prev().find("input").attr('id', "deliveryPortInput"); //为input增加id属性
                    var deliveryPortInput = $("#deliveryPortInput");
                    var keyword = $(deliveryPortInput).val();
                    var hscodeQuery = '/user/common/dict-fuzzy-query-ajax';
                    clearTimeout(timeOut);
                    timeOut = setTimeout(function () {
                        $.ajax({
                            type: "POST",
                            url: hscodeQuery,
                            data: {
                                dictCode: $(dischargePortSelect).attr("data-dict-code"),
                                langCode: '<?php echo $this->userLangCode; ?>',
                                keyword: keyword
                            },
                            dataType: "json",
                            success: function (data) {
                                var optionString = "";
                                if (data.length <= 0) {
                                    optionString += "<option value=''><?php echo $this->translate('et_select'); ?></option>";
                                }
                                $.each(data, function (i, item) {
                                    // console.log(item);
                                    optionString += "<option value='" + item.id + "'>" + item.name + "</option>";
                                });

                                $(dischargePortSelect).html("");
                                $(dischargePortSelect).append(optionString);
                                $(dischargePortSelect).selectpicker('refresh');
                            }
                        });
                    }, 100);
                }
            })
        });

        // 交货港
        $(deliveryPortSelect).on('shown.bs.select', function (e) {
            $(deliveryPortSelect).prev().find("input").keyup(function (event) {
                var e = event || window.event || arguments.callee.caller.arguments[0];
                if (e && e.keyCode !== 38 && e.keyCode !== 40) { // 按 Up Down
                    $(deliveryPortSelect).prev().find("input").attr('id', "dischargePortInput"); //为input增加id属性
                    var dischargePortInput = $("#dischargePortInput");
                    var keyword = $(dischargePortInput).val();
                    var hscodeQuery = '/user/common/dict-fuzzy-query-ajax';
                    clearTimeout(timeOut);
                    timeOut = setTimeout(function () {
                        $.ajax({
                            type: "POST",
                            url: hscodeQuery,
                            data: {
                                dictCode: $(deliveryPortSelect).attr("data-dict-code"),
                                langCode: '<?php echo $this->userLangCode; ?>',
                                keyword: keyword
                            },
                            dataType: "json",
                            success: function (data) {
                                var optionString = "";
                                if (data.length <= 0) {
                                    optionString += "<option value=''><?php echo $this->translate('et_select'); ?></option>";
                                }
                                $.each(data, function (i, item) {
                                    // console.log(item);
                                    optionString += "<option value='" + item.id + "'>" + item.name + "</option>";
                                });

                                $(deliveryPortSelect).html("");
                                $(deliveryPortSelect).append(optionString);
                                $(deliveryPortSelect).selectpicker('refresh');
                            }
                        });
                    }, 100);
                }
            })
        });

        $selectBuyerContactBtn.click(function () {
            // alert('getSelections: ' + JSON.stringify($buyerTable.bootstrapTable('getSelections')));
            var selections = $buyerContactListTable.bootstrapTable('getSelections');
            if (selections.length > 0) {
                $("#buyerContactID").val(selections[0].contactID);
                $('#buyerContactName').val(selections[0].name);
                $buyerContactModal.modal('hide');
            }
        });

        $selectContactBtn.click(function () {
            // alert('getSelections: ' + JSON.stringify($buyerTable.bootstrapTable('getSelections')));
            var selections = $contactListTable.bootstrapTable('getSelections');
            if (selections.length > 0) {
                $("#vendorContactID").val(selections[0].contactID);
                $('#vendorContactName').val(selections[0].name);
                $contactModal.modal('hide');
            }
        });

        $orderItemModal.on('show.bs.modal', function () {
            $orderItemListTable.bootstrapTable('uncheckAll');
            var selectProducts = $(".productAlert");
            $.each(selectProducts, function () {
                var productID = $(this).attr("id");
                $orderItemListTable.bootstrapTable('checkBy', {field:'productID', values:[productID]});
            });
        });

        $selectOrderItemBtn.click(function () {
            // alert('getSelections: ' + JSON.stringify($buyerTable.bootstrapTable('getSelections')));
            // console.log(JSON.stringify($orderItemListTable.bootstrapTable('getSelections')));
            var selections = $orderItemListTable.bootstrapTable('getSelections');
            $.each(selections, function (index, item) {
                var $productDiv = $("div[id='" + item.productID + "']");
                if ($productDiv.length > 0) {
                    return true;
                }

                var data = $.data(dataDict, 'dataDict');
                var productPricingUnit = "";
                $.each(data, function (key, dictItem) {
                    if (key === 'PRODUCT_PRICING_UNIT') {
                        $.each(dictItem, function (i, dict) {
                            if (dict.code === item.pricingUnit) {
                                productPricingUnit = dict.name;
                            }
                        });
                    }
                });

                var content = '<div class="alert alert-info alert-dismissible productAlert" role="alert" id="' + item.productID + '" data-type="product">' +
                    '   <input type="hidden" name="productSize" value="' + item.productSize + '">' +
                    '   <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>' +
                    '   <div class="form-group">' +
                    '       <label for="" class="col-sm-2 control-label"><?php echo $this->translate("productNAME"); ?></label>' +
                    '       <div class="col-sm-3">' +
                    '           <p class="form-control-static">' + item.productName + '</p>' +
                    '           <input type="hidden" name="productName[]" value="' + item.productName + '">' +
                    '           <input type="hidden" name="productID[]" value="' + item.productID + '">' +
                    '           <input type="hidden" name="itemID[]" value="' + item.itemID + '">' +
                    '           <input type="hidden" name="purchaseCrnCode[]" id="purchaseCrnCode_' + item.productID + '" value="' + item.purchaseCrnCode + '">' +
                    '       </div>' +

                    '       <label for="productEnName" class="col-sm-2 control-label"><?php echo $this->translate("productENNAME"); ?></label>' +
                    '       <div class="col-sm-3">' +
                    '           <input type="text" class="form-control" name="productEnName[]" id="productEnName" value="' + item.productEnName + '">' +
                    '       </div>' +
                    '   </div>' +

                    '   <div class="form-group">' +
                    '       <label for="packingType" class="col-sm-2 control-label"><?php echo $this->translate("packageTYPE"); ?></label>' +
                    '       <div class="col-sm-3">' +
                    '           <select class="selectpicker form-control" name="packingType[]" id="packingType_' + item.productID + '" data-live-search="true">' +
                    '               <?php echo $this->ShowDictionaryList($this->dic_Setting["PRODUCT_PACKING_TYPE"], $this->userLangCode, $this->dic_Setting["PRODUCT_PACKING_TYPE"], $this->orders['packingType']); ?>' +
                    '           </select>' +
                    '       </div>' +

                    '       <label for="hscode" class="col-sm-2 control-label"><?php echo $this->translate("HSCODE"); ?></label>' +
                    '       <div class="col-sm-3">' +
                    '           <p class="form-control-static">' + item.hscode + '</p>' +
                    '           <input type="hidden" name="hscode[]" id="hscode" value="' + item.hscode + '">' +
                    '       </div>' +
                    '   </div>' +

                    '   <div class="form-group">' +
                    '       <label for="brand" class="col-sm-2 control-label"><?php echo $this->translate("brand"); ?></label>' +
                    '       <div class="col-sm-3">' +
                    '           <input type="text" class="form-control" name="productBrand[]" id="productBrand_' + item.productID + '" value="' + item.productBrand + '">' +
                    '       </div>' +

                    '       <label for="model" class="col-sm-2 control-label"><?php echo $this->translate("model"); ?></label>' +
                    '       <div class="col-sm-3">' +
                    '           <input type="text" class="form-control" name="productModel[]" id="productModel_' + item.productID + '" value="' + item.productModel + '">' +
                    '           <input type="hidden" name="productionMode[]" id="productionMode_' + item.productID + '" value="' + item.productionMode + '">' +
                    '           <input type="hidden" name="supplierID[]" id="supplierID_' + item.productID + '" value="' + item.supplierID + '">' +
                    '       </div>' +
                    '   </div>' +

                    '   <div class="form-group">' +
                    '       <label for="productMaterial" class="col-sm-2 control-label"><?php echo $this->translate("productMaterial"); ?></label>' +
                    '       <div class="col-sm-8">' +
                    '           <input type="text" class="form-control" name="productMaterial[]" id="productMaterial" value="' + item.productMaterial + '">' +
                    '       </div>' +
                    '   </div>' +

                    '   <div class="form-group">' +
                    '       <label for="functionUsage" class="col-sm-2 control-label"><?php echo $this->translate("functionUsage"); ?></label>' +
                    '       <div class="col-sm-8">' +
                    '           <input type="text" class="form-control" name="functionUsage[]" id="functionUsage" value="' + item.functionUsage + '">' +
                    '       </div>' +
                    '   </div>' +

                    '   <div class="form-group">' +
                    '       <label for="model" class="col-sm-2 control-label"><?php echo $this->translate("number"); ?></label>' +
                    '       <div class="col-sm-2">' +
                    '           <input type="text" class="form-control" name="quantity[]" id="quantity_' + item.productID + '" data-productID="' + item.productID + '" data-type="quantity" value="' + (item.quantity === undefined ? 1 : item.quantity) + '">' +
                    '           <input type="hidden" name="pricingUnit[]" value="' + item.pricingUnit + '">' +
                    '       </div>' +
                    '       <div class="col-sm-1">' +
                    '           <p class="form-control-static">' + productPricingUnit + '</p>' +
                    '       </div>' +

                    '       <label for="totalPackage" class="col-sm-2 control-label"><?php echo $this->translate("quantity"); ?></label>' +
                    '       <div class="col-sm-3">' +
                    '           <input type="text" class="form-control" name="totalPackage[]" id="totalPackage_' + item.productID + '" data-productID="' + item.productID + '" value="' + (item.packingQuantity <= 0 ? 1 : item.packingQuantity) + '">' +
                    '           <input type="hidden" name="packingQuantity_' + item.productID + '" value="' + item.packingQuantity + '">' +
                    '       </div>' +
                    '   </div>' +

                    '   <div class="form-group">' +
                    '       <label for="unitPrice" class="col-sm-2 control-label"><?php echo $this->translate("orderprice"); ?></label>' +
                    '       <div class="col-sm-2">' +
                    '           <input type="text" class="form-control" name="unitPrice[]" id="unitPrice_' + item.productID + '" data-productID="' + item.productID + '" data-type="unitPrice" value="' + (item.unitPrice === undefined ? 0 : item.unitPrice) + '">' +
                    '       </div>' +
                    '       <div class="col-sm-1">' +
                    '           <p class="form-control-static">x</p>' +
                    '       </div>' +
                    '       <div class="col-sm-1">' +
                    '           <b><p class="form-control-static quantityMul_' + item.productID + '" data-productID="' + item.productID + '">' + (item.quantity === undefined ? 1 : item.quantity) + '</p></b>' +
                    '       </div>' +
                    '       <div class="col-sm-1">' +
                    '           <p class="form-control-static">=</p>' +
                    '       </div>' +
                    '       <div class="col-sm-1">' +
                    '           <p class="form-control-static unitPriceCrnCode" data-productID="' + item.productID + '">' + item.crnCode + '</p>' +
                    '       </div>' +
                    '       <div class="col-sm-2">' +
                    '           <input type="text" class="form-control" name="totalPrice[]" id="totalPrice_' + item.productID + '" data-productID="' + item.productID + '" data-type="totalPrice" value="' + (item.unitPrice === undefined ? 0 : item.unitPrice) + '">' +
                    '       </div>' +
                    '   </div>' +

                    '   <div class="form-group">' +
                    '       <label for="totalNetWeight" class="col-sm-2 control-label"><?php echo $this->translate("netWeight"); ?></label>' +
                    '       <div class="col-sm-2">' +
                    '           <input type="text" class="form-control" name="netWeight[]" id="netWeight_' + item.productID + '" data-productID="' + item.productID + '" value="' + (item.netWeight === undefined ? 0 : item.netWeight) + '">' +
                    '       </div>' +
                    '       <div class="col-sm-1">' +
                    '           <p class="form-control-static">x</p>' +
                    '       </div>' +
                    '       <div class="col-sm-1">' +
                    '           <b><p class="form-control-static quantityMul_' + item.productID + '" data-productID="' + item.productID + '">' + (item.quantity === undefined ? 1 : item.quantity) + '</p></b>' +
                    '       </div>' +
                    '       <div class="col-sm-1">' +
                    '           <p class="form-control-static">=</p>' +
                    '       </div>' +
                    '       <div class="col-sm-2">' +
                    '           <input type="text" class="form-control" name="totalNetWeight[]" id="totalNetWeight_' + item.productID + '" data-productID="' + item.productID + '" data-type="totalNetWeight" value="' + (item.netWeight === undefined ? 0 : item.netWeight) + '">' +
                    '       </div>' +
                    '       <div class="col-sm-1">' +
                    '           <p class="form-control-static">KGS</p>' +
                    '       </div>' +
                    '   </div>' +

                    '   <div class="form-group">' +
                    '       <label for="totalNetWeight" class="col-sm-2 control-label"><?php echo $this->translate("grossWeight"); ?></label>' +
                    '       <div class="col-sm-2">' +
                    '           <input type="text" class="form-control" name="grossWeight[]" id="grossWeight_' + item.productID + '" data-productID="' + item.productID + '" value="' + (item.grossWeight === undefined ? 0 : item.grossWeight) + '">' +
                    '       </div>' +
                    '       <div class="col-sm-1">' +
                    '           <p class="form-control-static">x</p>' +
                    '       </div>' +
                    '       <div class="col-sm-1">' +
                    '           <b><p class="form-control-static quantityMul_' + item.productID + '" data-productID="' + item.productID + '">' + (item.quantity === undefined ? 1 : item.quantity) + '</p></b>' +
                    '       </div>' +
                    '       <div class="col-sm-1">' +
                    '           <p class="form-control-static">=</p>' +
                    '       </div>' +
                    '       <div class="col-sm-2">' +
                    '           <input type="text" class="form-control" name="totalGrossWeight[]" id="totalGrossWeight_' + item.productID + '" data-productID="' + item.productID + '" data-type="totalGrossWeight" value="' + (item.grossWeight === undefined ? 0 : item.grossWeight) + '">' +
                    '       </div>' +
                    '       <div class="col-sm-1">' +
                    '           <p class="form-control-static">KGS</p>' +
                    '       </div>' +
                    '   </div>';

                if ($("#quotationMode").val() === 'IV') {
                    content += '   <div class="form-group purchaseUnitPriceInfo">' +
                        '       <label for="purUnitPrice" class="col-sm-2 control-label purchaseUnitPrice"><?php echo $this->translate("uiprice"); ?></label>' +
                        '       <div class="col-sm-2">' +
                        '           <input type="text" class="form-control" name="purUnitPrice[]" id="purchaseUnitPrice_' + item.productID + '" data-productID="' + item.productID + '" data-type="purchaseUnitPrice" value="' + (item.purchaseUnitPrice === undefined ? 0 : item.purchaseUnitPrice) + '">' +
                        '       </div>' +
                        '       <div class="col-sm-1">' +
                        '           <p class="form-control-static">x</p>' +
                        '       </div>' +
                        '       <div class="col-sm-1">' +
                        '           <b><p class="form-control-static quantityMul_' + item.productID + '" data-productID="' + item.productID + '">' + (item.quantity === undefined ? 1 : item.quantity) + '</p></b>' +
                        '       </div>' +
                        '       <div class="col-sm-1">' +
                        '           <p class="form-control-static">=</p>' +
                        '       </div>' +
                        '       <div class="col-sm-1">' +
                        '           <p class="form-control-static">' + item.purchaseCrnCode + '</p>' +
                        '       </div>' +
                        '       <div class="col-sm-2">' +
                        '           <input type="text" class="form-control" name="totalPurPrice[]" id="totalPurPrice_' + item.productID + '" data-productID="' + item.productID + '" data-type="totalPurPrice" value="' + (item.purchaseUnitPrice === undefined ? 0 : item.purchaseUnitPrice) + '">' +
                        '       </div>' +
                        '   </div>';
                } else {
                    if (item.productionMode === '01') {
                        content += '   <div class="form-group purchaseUnitPriceInfo" style="display: none;">';
                    } else {
                        content += '   <div class="form-group purchaseUnitPriceInfo">';
                    }
                    content += '       <label for="purUnitPrice" class="col-sm-2 control-label purchaseUnitPrice"><?php echo $this->translate("purchaseUnitPrice"); ?></label>' +
                        '       <div class="col-sm-2">' +
                        '           <input type="text" class="form-control" name="purUnitPrice[]" id="purchaseUnitPrice_' + item.productID + '" data-productID="' + item.productID + '" data-type="purchaseUnitPrice" value="' + (item.purchaseUnitPrice === undefined ? 0 : item.purchaseUnitPrice) + '">' +
                        '       </div>' +
                        '       <div class="col-sm-1">' +
                        '           <p class="form-control-static">x</p>' +
                        '       </div>' +
                        '       <div class="col-sm-1">' +
                        '           <b><p class="form-control-static quantityMul_' + item.productID + '" data-productID="' + item.productID + '">' + (item.quantity === undefined ? 1 : item.quantity) + '</p></b>' +
                        '       </div>' +
                        '       <div class="col-sm-1">' +
                        '           <p class="form-control-static">=</p>' +
                        '       </div>' +
                        '       <div class="col-sm-1">' +
                        '           <p class="form-control-static">' + item.purchaseCrnCode + '</p>' +
                        '       </div>' +
                        '       <div class="col-sm-2">' +
                        '           <input type="text" class="form-control" name="totalPurPrice[]" id="totalPurPrice_' + item.productID + '" data-productID="' + item.productID + '" data-type="totalPurPrice" value="' + (item.purchaseUnitPrice === undefined ? 0 : item.purchaseUnitPrice) + '">' +
                        '       </div>' +
                        '   </div>';
                }
                content += '</div>' +
                    '';

                $orderItemDiv.append(content);

                // 更新包装类型默认选中项
                var $packingType = $("#packingType_" + item.productID);
                $packingType.val(item.packingType);
                $packingType.selectpicker('render');

                $("input[name='quantity[]'], input[name='unitPrice[]'], input[name='totalPrice[]'], input[name='purUnitPrice[]'], input[name='totalPurPrice[]'], input[name='netWeight[]'], input[name='grossWeight[]'], input[name='totalNetWeight[]'], input[name='totalGrossWeight[]']").keyup(function () {
                    var productID = $(this).attr("data-productID"),     // ID
                        $quantity = $("#quantity_" + productID),        // 数量
                        quantityMul = $(".quantityMul_" + productID),   // 数量Label
                        $unitPrice = $("#unitPrice_" + productID),      // 价格
                        $totalPrice = $("#totalPrice_" + productID),    // 金额
                        $purchaseUnitPrice = $("#purchaseUnitPrice_" + productID),      // 采购价格
                        $totalPurPrice = $("#totalPurPrice_" + productID),              // 采购金额
                        $netWeight = $("#netWeight_" + productID),                      // 净重
                        $grossWeight = $("#grossWeight_" + productID),                  // 毛重
                        $totalNetWeight = $("#totalNetWeight_" + productID),            // 总净重
                        $totalGrossWeight = $("#totalGrossWeight_" + productID);        // 总毛重

                    console.log();
                    if ($quantity.val() !== "" && !$.isNumeric($quantity.val())) {
                        alert("数量必须是数值");
                        $quantity.val(1);
                    }
                    if ($unitPrice.val() !== "" && !$.isNumeric($unitPrice.val())) {
                        alert("价格必须是数值");

                        return false;
                    }
                    if ($totalPrice.val() !== "" && !$.isNumeric($totalPrice.val())) {
                        alert("金额必须是数值");
                        return false;
                    }

                    var dataType = $(this).attr("data-type");
                    if (dataType === "totalPrice") {
                        // 计算价格
                        $unitPrice.val(arithRound(arithDiv($totalPrice.val(), $quantity.val()), 2));
                    } else if (dataType === "totalPurPrice") {
                        // 计算采购价格
                        $purchaseUnitPrice.val(arithRound(arithDiv($totalPurPrice.val(), $quantity.val()), 2));
                    } else if (dataType === "totalNetWeight") {
                        // 计算净重
                        $netWeight.val(arithRound(arithDiv($totalNetWeight.val(), $quantity.val()), 4));
                    } else if (dataType === "totalGrossWeight") {
                        // 计算毛重
                        $grossWeight.val(arithRound(arithDiv($totalGrossWeight.val(), $quantity.val()), 4));
                    } else {
                        // 计算金额
                        $totalPrice.val(arithRound(arithMul($unitPrice.val(), $quantity.val()), 2));
                        // 计算采购价格
                        if ($purchaseUnitPrice !== undefined && $purchaseUnitPrice.length > 0 && $totalPurPrice !== undefined && $totalPurPrice.length > 0) {
                            $totalPurPrice.val(arithRound(arithMul($purchaseUnitPrice.val(), $quantity.val()), 2));
                        }
                        // 计算净重, 毛重
                        $totalNetWeight.val(arithRound(arithMul($netWeight.val(), $quantity.val()), 2));
                        $totalGrossWeight.val(arithRound(arithMul($grossWeight.val(), $quantity.val()), 2));
                    }

                    $.each(quantityMul, function () {
                       $(this).html($quantity.val());
                    });
                });
            });

            // 更新商品货币及重新计算汇率
            updateCrnCode($buyerCrnCode.val());

            $orderItemModal.modal('hide');
            // $("select[name='packingType[]']").selectpicker('render');
        });

        // Radio
        $(":radio").click(function () {
            if ($(this).val() === '0') {
                if ($(this).attr("name") === 'needShipping') {
                    $(".shippingRequest").hide();
                } else if ($(this).attr("name") === 'isAssignCustomsAgency') {
                    $(".agencyInfo").hide();
                } else if ($(this).attr("name") === 'needFinancing') {
                    $(".financingRequest").hide();
                }
            } else if ($(this).val() === '1') {
                if ($(this).attr("name") === 'needShipping') {
                    $(".shippingRequest").show();
                } else if ($(this).attr("name") === 'isAssignCustomsAgency') {
                    $(".agencyInfo").show();
                } else if ($(this).attr("name") === 'needFinancing') {
                    $(".financingRequest").show();
                }
            }
        });

        if ($("input[name='needShipping']:checked").val() === '0') {

        }
	});

	function updateCrnCode(crnCode) {
        // 更新价格货币
        var $unitPriceCrnCodes = $(".unitPriceCrnCode");

        $.each($unitPriceCrnCodes, function () {
            if (crnCode !== $(this).html()) {
                var productID = $(this).attr("data-productID"),
                    $unitPriceCrnCode = $(this);
                // 取汇率重新计算
                var exchangeRate = '/user/common/exchange-rate-ajax';
                $.ajax({
                    type: "POST",
                    url: exchangeRate,
                    data: {
                        baseCrn: $(this).html(),
                        contraCrn: crnCode
                    },
                    dataType: "json",
                    success: function (data) {
                        var $quantity = $("#quantity_" + productID),        // 数量
                            $unitPrice = $("#unitPrice_" + productID),      // 价格
                            $totalPrice = $("#totalPrice_" + productID);

                        // 价格, 金额
                        $unitPrice.val(arithRound(arithMul($unitPrice.val(), data), 2));
                        $totalPrice.val(arithRound(arithMul($unitPrice.val(), $quantity.val()), 2));

                        // 更新货币
                        $unitPriceCrnCode.html(crnCode);
                    }
                });
            }
        });

        // 更新金额货币
        var $totalPriceCrnCode = $(".totalPriceCrnCode");
        $.each($totalPriceCrnCode, function () {
            if (crnCode !== $(this).html()) {
                // 更新货币
                $(this).html(crnCode);
            }
        });
    }
</script>
</body>
</html>
