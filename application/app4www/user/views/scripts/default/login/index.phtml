<!DOCTYPE html>
<html lang="zh-CN">
<head>
<?php echo $this->render(SEED_WWW_TPL . '/layouts/headerLink.phtml'); ?>
	<title>快移</title>
	<link href="/ky/css/login/login.css" rel="stylesheet">
    <link href="/ky/css/layouts/base.css" rel="stylesheet">
</head>
<body onload="document.login_form.ecommloginname.focus()">

<nav class="navbar navbar-default navbar-static-top top-memu shadow">
	<div class="container">
		<div class="navbar-header">
			<a class="navbar-brand" href="javascript:void(0)">
				<img alt="eTradeFast" title="eTradeFast" src="/ky/images/index/Logo_loginH75.png">
			</a>
		</div>
		<div class="collapse navbar-collapse">
			<p class="navbar-text">
				欢迎登录
			</p>
		</div>
	</div>
</nav>

<div class="container-fluid index-body">
	<div class="container">

		<div class="row">

			<div class="col-md-8 hidden-xs">
				<div class="row body-font">
					<div class="col-xs-10 col-sm-10 col-md-10 col-lg-10">
						快移平台
					</div>
					<div class="col-xs-7 col-sm-7 col-md-7 col-lg-7 col-md-offset-5">
						让交易更公平
					</div>
					<div class="col-xs-5 col-sm-5 col-md-5 col-lg-5 col-md-offset-7">
						更快捷
					</div>
					<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 col-md-offset-8">
						更有保障
					</div>
				</div>
			</div>

			<div class="col-md-4 login-body">
				<ul class="nav nav-pills">
					<li><a href="javascript:void(0)" id="switcher_plogin">帐号密码登录</a></li>
					<li><a href="javascript:void(0)" id="switcher_qlogin">扫码登录</a></li>
				</ul>

				<hr>
				<form class="form-horizontal login-body-form" action="<?php echo $this->baseUrl();?>/login" method="post" id="login_form" name="login_form">
					<div class="form-group">
						<label class="sr-only" for="ecommloginname"></label>
						<div class="input-group" style="margin-bottom: 15px;">
							<div class="input-group-addon">
								<span class="glyphicon glyphicon-user" aria-hidden="true" style="color: #777"></span>
							</div>
							<input type="email" class="form-control" name="ecommloginname" id="ecommloginname" value="<?php echo $this->rememberName;?>" required placeholder="<?php echo $this->translate('tip_eComm_login_name');?>">
						</div>
					</div>

					<div class="form-group">
						<label class="sr-only" for="ecommpasswsd"></label>
						<div class="input-group">
							<div class="input-group-addon">
								<span class="glyphicon glyphicon-lock" aria-hidden="true" style="color: #777"></span>
							</div>
							<input type="password" class="form-control" name="ecommpasswsd" id="ecommpasswsd" required placeholder="登录密码">
						</div>
					</div>

                    <?php if ($this->needAuthCode == '1'):?>
					<div class="form-group">
						<ul class="list-inline">
							<li>
								<label class="sr-only" for="authCode"></label>
								<div class="input-group">
									<input type="text" class="form-control" name="authCode" id="authCode" required placeholder="<?php echo $this->translate('tip_code');?>">
								</div>
							</li>
							<li class="pull-right">
								<img class="login-authCode_pic" id="authCodePic" src='/user/check/code' />
							</li>
						</ul>
					</div>
                    <?php endif;?>

					<div class="form-group">
						<ul class="list-inline">
							<li>
								<div class="checkbox">
									<label>
										<input type="checkbox" value="1" name="remember" id="remember" <?php if (!empty($this->rememberName)) {echo 'checked';} ?> >
                                        <?php echo $this->translate('tip_remember');?>
									</label>
								</div>
							</li>
							<li class="pull-right">
								<div>
									<a href="./forget" class="forgotPSD"><?php echo $this->translate('forgetPSD'); ?></a>
								</div>
							</li>
						</ul>
					</div>

					<div class="form-group">
						<button type="submit" class="btn btn-warning btn-default btn-block"><?php echo $this->translate('login'); ?></button>
					</div>

					<div class="form-group">
						<div class="col-sm-offset-4 col-sm-4">
							<div class="text-center">
								<a href="./register"><i class="far fa-user-circle" style="color: #f0ad4e;"></i>&nbsp;<?php echo $this->translate('userRegister'); ?></a>
							</div>
						</div>
					</div>
				</form>

                <div class="row qr-row hidden">
                    <div class="col-md-10 col-md-offset-1" id="qrLoginImg"></div>
                    <div class="col-md-10 col-md-offset-1">
                        <a href="#" class="btn btn-default center-block" role="button">使用手机快移扫描登录</a>
                    </div>

                    <div class="col-md-10 col-md-offset-1">
                        <div class="text-center">
                            <a href="/register"><i class="far fa-user-circle" style="color: #f0ad4e;"></i>&nbsp;<?php echo $this->translate('userRegister'); ?></a>
                        </div>
                    </div>
                </div>
			</div>
		</div>
	</div>
</div>

<?php echo $this->render(SEED_WWW_TPL . '/layouts/footer.phtml'); ?>

<?php echo $this->render(SEED_WWW_TPL . '/layouts/footerLink.phtml'); ?>
<script src="/ky/js/jquery.cookie.js"></script>

<script type="text/javascript">
    var ref = "";
	$().ready(function() {
		if ($.cookie("rmbUser") == "true") {
			$("#remember").attr("checked", true);
			$("#ecommloginname").val($.cookie("username"));
		}

		$("#login_form").validate({
			rules: {
				ecommpasswsd: {
					isValidPassword: true,
					minlength: 8,
					maxlength: 30
				}
			},
			messages: {
				ecommloginname: "<?php echo $this->translate('is_emails');?>",
				ecommpasswsd : {
					required: "<?php echo $this->translate('de_null'); ?>",
					minlength: "<?php echo $this->translate('mat_psd');?>",
					maxlength: "<?php echo $this->translate('is_passwd');?>"
				}
			},
			errorPlacement: function(error, element) {
				// Append error within linked label
				$(element)
					.closest( "form" )
					.find( "label[for='" + element.attr( "id" ) + "']" )
					.parent().addClass("has-error").removeClass("has-success")
					.append( error );
			},
			success: function(label) {
				var forName = $(label).attr("for");
				$("label[for='" + forName + "']").parent().addClass("has-success").removeClass("has-error");
				$(label).remove();
			},
			highlight: function (element) {
				$("label[for='" + element.id + "']").parent().addClass("has-error").removeClass("has-success");
			},
			submitHandler: function (form) {
				if ($("#remember").prop('checked')) {
					var str_username = $("#ecommloginname").val();
					$.cookie("rmbUser", "true", {expires: 365}); //存储一个带7天期限的cookie
					$.cookie("username", str_username, {expires: 365});
				} else {
					$.cookie("rmbUser", "false", {expire: -1});
					$.cookie("username", "", {expires: -1});
					$.cookie("password", "", {expires: -1});
				}
				form.submit();
			}
		});
	});

	// function changing() {
	// 	document.getElementById('checkpic').src = "/user/check/code?" + Math.random();
	// }

	$(function () {
		$("#authCodePic").click(function () {
			$(this).attr("src", "/user/check/code?" + Math.random());
		});

		// 密码登录
        $("#switcher_plogin").click(function () {
            $(".qr-row").addClass("hidden").removeClass("show");
            $("#login_form").show();

            clearInterval(ref);
        });

        // 扫码登录
		$("#switcher_qlogin").click(function () {
            $("#login_form").hide();
            $(".qr-row").addClass("show").removeClass("hidden");

            $.get("<?php echo $this->BaseUrl();?>/login/qrloginimg",function(data){
                $("#qrLoginImg").html("<img src=\"data:image/gif;base64,"+data+"\" class=\"img-thumbnail center-block\" />");
            });

            ref = setInterval(function(){
                pollQrLogin();
            }, 5000);
        });
	});

	function pollQrLogin() {
        var qrLogin = '/user/login/qrlogin';
        $.post(qrLogin, function () {

        }, 'json').success(function (data) {
            if (data === 1) {
                location.href = "/";
            } else {
                console.log(data);
            }
        });
    }

	// 密码规验证(8-30位  字母数字)
	jQuery.validator.addMethod("isValidPassword", function(value, element) {
		var regExp=/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,30}$/;
		return this.optional(element) || (regExp.test(value));
	}, "<?php echo $this->translate('is_passwd');?>");
</script>
</body>
</html>
